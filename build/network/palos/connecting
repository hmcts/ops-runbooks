<h1 id="connecting-to-a-palo-alto-firewall">Connecting to a Palo Alto firewall</h1>
<h2 id="uk-south">UK South</h2>
<p>You can connect to the Palo VMs via the HMCTS VPN by following the following steps:</p>
<h3 id="sandbox">Sandbox</h3>

<ol>
<li>Create the NSG rule to allow your IP on port 443. (Example and links to VMs below).</li>
<li>Retrieve the url of the Palo VM you want to connect to via the &lsquo;Virtual machines&rsquo; section below.</li>
<li>(skip in production which is SSO enabled) Retrieve the admin password from the sandbox key vault:
<code>
az keyvault secret show --vault-name hmcts-infra-dmz-sbox-int --name firewall-password --query value -o tsv
</code></li>
<li>Use the local account <code>localadmin</code> to log in.</li>
</ol>

<details>

<summary>Sandbox virtual machines</summary>

### Sandbox

- [hmcts-hub-sbox-int-palo-vm-0](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/ea3a8c1e-af9d-4108-bc86-a7e2d267f49c/resourceGroups/hmcts-hub-sbox-int/providers/Microsoft.Compute/virtualMachines/hmcts-hub-sbox-int-palo-vm-0/overview) - https://hmcts-hub-sbox-int-palo-mgmt-0.uksouth.cloudapp.azure.com
- [hmcts-hub-sbox-int-palo-vm-1](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/ea3a8c1e-af9d-4108-bc86-a7e2d267f49c/resourceGroups/hmcts-hub-sbox-int/providers/Microsoft.Compute/virtualMachines/hmcts-hub-sbox-int-palo-vm-1/overview) - https://hmcts-hub-sbox-int-palo-mgmt-1.uksouth.cloudapp.azure.com

</details>
<h3 id="non-prod">Non-prod</h3>

<ol>
<li>Connect to the <a href="https://portal.platform.hmcts.net/">HMCTS VPN</a>.</li>
<li>Retrieve the url of the Palo VM you want to connect to via the &lsquo;Virtual machines&rsquo; section below.<br></li>
<li><p>Retrieve the admin password from the relevant key vault:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code># Non production
az keyvault secret show --vault-name hmcts-infra-dmz-nonprodi --name firewall-password --query value -o tsv
</code></pre></div></li>
<li><p>Use the local account <code>localadmin</code></p></li>
</ol>

<details>

<summary>Non-prod virtual machines</summary>

- [hmcts-hub-nonprodi-palo-vm-0](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/fb084706-583f-4c9a-bdab-949aac66ba5c/resourceGroups/hmcts-hub-nonprodi/providers/Microsoft.Compute/virtualMachines/hmcts-hub-nonprodi-palo-vm-0/overview) - https://hmcts-hub-nonprodi-palo-mgmt-0.uksouth.cloudapp.azure.com
- [hmcts-hub-nonprodi-palo-vm-1](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/fb084706-583f-4c9a-bdab-949aac66ba5c/resourceGroups/hmcts-hub-nonprodi/providers/Microsoft.Compute/virtualMachines/hmcts-hub-nonprodi-palo-vm-1/overview) - https://hmcts-hub-nonprodi-palo-mgmt-1.uksouth.cloudapp.azure.com

</details>
<h3 id="production">Production</h3>

<ol>
<li>Connect to the <a href="https://portal.platform.hmcts.net/">HMCTS VPN</a>.</li>
<li>Retrieve the url of the Palo VM you want to connect to via the &lsquo;Virtual machines&rsquo; section below.<br></li>
<li>Click &lsquo;Use Single Sign-On&rsquo;.</li>
<li>Press &lsquo;Continue&rsquo; leaving the first text box prompt empty.</li>
</ol>

<details>

<summary>Virtual machines</summary>

### Production

- [hmcts-hub-prod-int-palo-vm-0](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/hmcts-hub-prod-int/providers/Microsoft.Compute/virtualMachines/hmcts-hub-prod-int-palo-vm-0/overview) - https://uksouth-prod-palo-0.platform.hmcts.net
- [hmcts-hub-prod-int-palo-vm-1](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/hmcts-hub-prod-int/providers/Microsoft.Compute/virtualMachines/hmcts-hub-prod-int-palo-vm-1/overview) - https://uksouth-prod-palo-1.platform.hmcts.net

</details>

<hr>
<h2 id="uk-west">UK West</h2>
<p>The connectivity for the UK West Palos, via the VPN, is not currently set up so connecting to them is slightly different to UK south.
To access these Palos you will need add a rule to allow connectivity from your IP address to the Palo on port 443.
You can add a rule by going to the VMs via one of the links below and adding an inbound rule on the Networking tab.</p>

<ol>
<li>Create the NSG rule to allow your IP on port 443. (Example and links to VMs below)</li>
<li>Retrieve the url of the Palo VM you want to connect to via the &lsquo;Virtual machines&rsquo; section below.</li>
<li><p>Retrieve the admin password from the relevant key vault:
&ldquo;`</p>
<h1 id="sandbox-2">Sandbox</h1>
<p>az keyvault secret show &ndash;vault-name ukw-infra-dmz-sbox-int &ndash;name firewall-password &ndash;query value -o tsv</p>
<h1 id="non-production">Non Production</h1>
<p>az keyvault secret show &ndash;vault-name ukw-infra-dmz-nonprodi &ndash;name firewall-password &ndash;query value -o tsv</p>
<h1 id="production-2">Production</h1>
<p>az keyvault secret show &ndash;vault-name ukw-infra-dmz-prod-int &ndash;name firewall-password &ndash;query value -o tsv
&rdquo;`</p></li>
<li><p>Use the local account <code>localadmin</code></p></li>
</ol>

<details>

<summary>Example Rule</summary>

![Validate Button](images/nsg-rule.png)

</details>
<p>Remember to remove the rule once you no longer need access.</p>

<details>

<summary>Virtual machines</summary>

### Sandbox

- [ukw-hub-sbox-int-palo-vm-0](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/ea3a8c1e-af9d-4108-bc86-a7e2d267f49c/resourceGroups/UKW-HUB-SBOX-INT/providers/Microsoft.Compute/virtualMachines/ukw-hub-sbox-int-palo-vm-0/overview) - https://ukw-hub-sbox-int-palo-mgmt-0.ukwest.cloudapp.azure.com
- [ukw-hub-sbox-int-palo-vm-1](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/ea3a8c1e-af9d-4108-bc86-a7e2d267f49c/resourceGroups/UKW-HUB-SBOX-INT/providers/Microsoft.Compute/virtualMachines/ukw-hub-sbox-int-palo-vm-1/overview) - https://ukw-hub-sbox-int-palo-mgmt-0.ukwest.cloudapp.azure.com

### Non Production

- [ukw-hub-nonprodi-palo-vm-0](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/fb084706-583f-4c9a-bdab-949aac66ba5c/resourceGroups/ukw-hub-nonprodi/providers/Microsoft.Compute/virtualMachines/ukw-hub-nonprodi-palo-vm-0/overview) - https://ukw-hub-nonprodi-palo-mgmt-0.ukwest.cloudapp.azure.com
- [ukw-hub-nonprodi-palo-vm-1](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/fb084706-583f-4c9a-bdab-949aac66ba5c/resourceGroups/ukw-hub-nonprodi/providers/Microsoft.Compute/virtualMachines/ukw-hub-nonprodi-palo-vm-1/overview) - https://ukw-hub-nonprodi-palo-mgmt-0.ukwest.cloudapp.azure.com

### Production 
- [ukw-hub-prod-int-palo-vm-0](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/UKW-HUB-PROD-INT/providers/Microsoft.Compute/virtualMachines/ukw-hub-prod-int-palo-vm-0/overview) - https://ukw-hub-prod-int-palo-mgmt-0.ukwest.cloudapp.azure.com
- [ukw-hub-prod-int-palo-vm-1](https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/UKW-HUB-PROD-INT/providers/Microsoft.Compute/virtualMachines/ukw-hub-prod-int-palo-vm-1/overview) - https://ukw-hub-prod-int-palo-mgmt-1.ukwest.cloudapp.azure.com

</details>
