---
title: Artifactory Patching
weight: 30
last_reviewed_on: 2024-06-06
review_in: 12 months
---

# <%= current_page.data.title %>

Artifactory is utilized in the context of managing and updating software dependencies and configurations within a Kubernetes environment.
Here's how it is used based on the provided instructions:

The steps below will show you how to check the current **self-hosted version** of Artifactory being used and then to update it to a newer **self-hosted version**. This process involves accessing <[Artifactory's website](https://jfrog.com/help/r/jfrog-release-information/artifactory-release-notes)> to determine the latest **self-hosted version** version available.

Before applying the update on PTL AKS Cluster, a testing process is initiated and is conducted on PTLSBOX AKS Cluster. This involves downloading the repository on <[GitHub](https://github.com/hmcts/cnp-flux-config)> containing configuration files for Artifactory and creating (artifactory-sbox.yaml). This file is then modified to reflect the desired changes, such as updating the version number.

Kubernetes configuration files (kustomization.yaml) are updated to include the changes made in the testing phase. This ensures that the updated configuration is applied correctly within the Kubernetes cluster.

<[Exampe PR showing artifactory-sbox.yaml and kustomization.yaml](https://github.com/hmcts/cnp-flux-config/pull/32185/files)>

Changes made to the configuration files are submitted for review through a pull request (PR) process. Once approved, the changes are merged into the main branch, allowing them to be deployed.

If any issues arise during the update process, troubleshooting steps are provided. These steps involve identifying and resolving any errors or conflicts that may occur, such as missing namespaces or configuration discrepancies.

# Artifactory Patching Process

## 1. Azure CLI Login and Kubernetes Services

  • Access Azure CLI and search for Kubernetes Services

  • Type the "PTL" in the search box:

  ![Azure portal displaying key search 'ptl' and hovering over 'cft-ptlsbox-00-aks'](Images/artifactory_pic01.png)

## 2. Connect to PTLSBOX

  • Click on "cft-ptlsbox-00-aks"

  • Navigate to Connect and open Terminal

  • Connect using the provided commands (first three)

  **Note:** Ensure correct cluster connection with the provided commands

## 3. Check Artifactory Pods

  • In the terminal, execute the following command to display artifactory pods:

  ```command
  kubectl get pods -n artifactory 
  ```

  ![Kubectl command displaying artifactory pods that are running](Images/artifactory_pic02.png)

  This command describes one of the artifactory pods, note the version number at "artifactory-oss"

  ```command
  kubectl describe pods -n artifactory artifactory-oss-0 
  ```

  ![Kubectl command describing pod and displaying container information](Images/artifactory_pic03.png)

## 4. Updating PTLSBOX

  • Create a new file named "artifactory-sbox.yaml" with the code found in the example pr in the following directory: <https://github.com/hmcts/cnp-flux-config/tree/master/apps/artifactory/artifactory>
  
  • Update artifactory-oss with **latest self-hosted version** <[Artifactory Release Information](https://jfrog.com/help/r/jfrog-release-information/artifactory-release-notes)> eg (7.84.12)

  • Add the kustomization code to the kustomization.yaml file described in the example pr in the found here: <https://github.com/hmcts/cnp-flux-config/blob/master/apps/artifactory/sbox-intsvc/base/kustomization.yaml>

   <[Example PR with artifactory-sbox.yaml and kustomization.yaml](https://github.com/hmcts/cnp-flux-config/pull/32185/files)>
  
  • Raise a PR and push changes out for review and approval
  
  • Once approved merge changes and check version has updated in PTLSBOX cluster

## 5. Check Version on PTLSBOX
  
  • Run the following command and make sure pods are initialising/running with no errors

  ```command
  kubectl get pods -n artifactory
  ```

  • Run the following command and make sure pod has picked up new version, note the version number at "artifactory-oss"

  ```command
  kubectl describe pods -n artifactory artifactory-oss-0
  ```

## 6. Update PTL

  • Remove "artifactory-sbox.yaml" file and its corresponding code from kustomization.yaml

  • Update the version in "artifactory.yaml" to latest version eg, 7.84.12

  ```command
        containers:
          - image: docker.bintray.io/jfrog/artifactory-oss:7.84.12
            name: artifactory-oss
  ```
  
  <[Example PR with above changes](https://github.com/hmcts/cnp-flux-config/pull/32191/files)>

## Related Links
  
  <[GitHub repo](https://github.com/hmcts/cnp-flux-config)>
  
  <[Artifactory](https://artifactory.sandbox.platform.hmcts.net/ui/repos/tree/General/hmcts)> - You will need to be connect to F5 VPN to access this link

  <[Artifactory Release Information](https://jfrog.com/help/r/jfrog-release-information/artifactory-release-notes)>
