---
title: Gaps2 Database Restore Pipeline
last_reviewed_on: 2025-05-01
review_in: 12 months
weight: 50
---

# <%= current_page.data.title %>

## ðŸ“Œ Overview  
This pipeline automates database restoration and Bacpac conversion for `.bak` files uploaded to Azure Storage (`SA`). It transforms a `.bak` file into a `.bacpac` and imports it into the Gaps2 DB (`ss-gaps2-sqldb`) on a small systems SQL instance (`ss01-sqlsrv-<env>`).  

## ðŸ“‚ File Upload Location  
Users upload `.bak` files to Storage Account (`SA`) via SFTP at:  `<Year>/<Month>/ss-gaps2-sqldb-<date>.bak` 

Example: `2025/05/ss-gaps2-sqldb-09.bak`

## ðŸ”— More About the Pipeline  
Details on pipeline execution, triggers, and configurations, visit the repository:  
ðŸ”— **[HMCTS MSSQL Backup Converter](https://github.com/hmcts/mssql-backup-converter/blob/main/README.md)**  

## ðŸ”¹ Expected Issues  

During the pipeline execution, certain **problematic database objects** are dropped before the import process to ensure a smooth transition.  

The **`sqlpackage`** tool performs a validation check on the `.bacpac` file before importing it into the database. If any new objects exist that are not accounted for in the predefined cleanup script, the import will fail.  

To resolve failures, problematic objects should be added to the drop script before re-running the pipeline:  

ðŸ”— **[Modify the cleanup script](https://github.com/hmcts/mssql-backup-converter/blob/main/sql-scripts/GAPS_DROP_PROBLEMATIC.sql)** to include newly identified problematic objects.  

## ðŸ“ž Contacts  
For inquiries regarding the **Gaps2 project**, you can find the relevant contact details on Confluence:  

ðŸ”— **[Ops Runbooks Contacts](https://tools.hmcts.net/confluence/display/DTSPO/Ops-runbooks+contacts)**  
