---
title: Decommission App Gateway  
last_reviewed_on: 2025-07-07  
review_in: 12 months  
weight: 20  
---

# <%= current_page.data.title %>

This document outlines the process for decommissioning an Application Gateway (AppGW) in the Crime environment. AppGW V1 instances are being phased out in favor of Azure API Management (APIM). Starting April 28, 2026, the Application Gateway V1 SKU will be retired and no longer supported.

The goal is to ensure all traffic is routed through APIM instead of AppGW.

We need to verify that all listeners currently using AppGW have been migrated to APIM. This includes updating DNS records and network security groups (NSGs) to allow traffic through APIM.

---

## Checking Connectivity

Before making any changes, verify that the APIM instance is reachable.

You can do this by accessing a cluster and running the following `curl` command:

![Checking connectivity](images/checking-connectivity.png)

Update DNS so that all APIM URLs (gateway, portal, and management) route through APIM instead of AppGW. This involves updating all listeners currently using AppGW to point to APIM.

Steps:

- Go to AppGW and navigate to **Settings > Listeners**.
- For each listener, check the backend pool and backend host to identify APIM instances.
- Update all listeners to point to APIM instead of AppGW.

![AppGW listeners](images/appgw-listeners..png)

Update DNS records:

1. Log in to the ADDS server by following this guide:  
   [How to verify and configure DNS in MDVADDS](https://tools.hmcts.net/confluence/display/CNP/How+to+verify+and+configure+the+DNS+in+MDVADDS) or SSH into the server:

```sh
ssh -f -N -L 33895:<adds ip>:3389 mpdjumpl01.cp.cjs.hmcts.net
```

Once the DNS entry is updated to point to APIM, verify connectivity:

On the AKS cluster, run:

```
curl --resolve <apim-domain>:443:<apim-ip> https://<apim-domain>
```

2) Check if DNS resolves to the APIM instance by updating your local hosts file.

3) You can also verify connectivity from the ADO agent in the pipeline by running a curl command. Either SSH into the ADO agent or run a pipeline job in the cpp-automation-terraform repo. 

[resolving-connection](images/resolving-connection.png)


The command should return a response confirming connectivity to the APIM instance and resolution to the correct IP address.


## Informing BAU

Notify BAU of the change by posting in the cpp-devops Slack channel and tagging the following individuals and groups:

James Widdowson
Pankaj Verma
embedded_devops
release_devops
sre_team

## Decommission App GatewayChat

Remove the AppGW code from the cpp-automation-terraform repository.

Note: This should be done as part of a release. Wait until the release is complete before removing the code.

For questions post-release, contact the release manager, Pankaj Verma.
