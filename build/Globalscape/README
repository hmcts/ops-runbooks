<h1 id="globalscape-eft-enterprise">Globalscape / EFT Enterprise</h1>
<p>This readme describes a bit about the Globalscape EFT service and how you can access the two VM&rsquo;s running it.</p>
<h2 id="description">Description</h2>
<p>The Hub GlobalScape provides SFTP / FTPS services for secure File Transfer between 3rd Parties. Some of these parties include SSCS, Probate, Reference Data and HMRC.</p>
<p>The solution has been built in the RDO-HUB-SFTP-PROD resource group in the HMCTS-HUB-PROD-INTSVC Azure subscription.</p>
<p>There is only one environment - production and it is manually configured.</p>
<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Enable JIT access to Production Bastion, you can do that <a href="https://myaccess.microsoft.com/">here</a>.</li>
<li>Connect to <a href="https://portal.platform.hmcts.net">F5</a>. </li>
</ul>
<p>As an alternative to below you can run the <code>globalscape-eft.sh</code> file on your local machine, just download the file and run <code>chmod +x globalscape-eft.sh;./globalscape-eft.sh</code>.</p>
<h2 id="connecting-to-bastion">Connecting to Bastion</h2>
<p>You need to connect to Bastion to port forward your traffic to the EFT VMs. In your shell, run the following command:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>az ssh config --ip \*.platform.hmcts.net --file ~/.ssh/config
</code></pre></div><h2 id="port-forwarding-via-bastion">Port forwarding via Bastion</h2>
<p>To port forward to the EFT VM, run the following command replacing the variable with the intended IP. You can find the IP by going to either the <a href="https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/RDO-HUB-SFTP-PROD/providers/Microsoft.Compute/virtualMachines/rdo-sftp-eft-0/overview">rdo-sftp-eft-0</a> or <a href="https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/RDO-HUB-SFTP-PROD/providers/Microsoft.Compute/virtualMachines/rdo-sftp-eft-1/overview">rdo-sftp-eft-1</a> resource, clicking Connect &gt; RDP &gt; IP address (Private IP).</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>ssh -L 5555:{VM-PRIVATE-IP}:3389 bastion-prod.platform.hmcts.net
</code></pre></div><p>This will leave you connected in the bastion shell, which means you&rsquo;re ready to connect to the EFT VMS. You can replace <code>5555</code> here with a port of your choice on your machine if you wish.</p>
<h2 id="connecting-to-the-vm">Connecting to the VM</h2>
<p>For the next step you&rsquo;ll need some RDP software on your machine, you can use <code>Windows Remote Desktop</code> for instance. Now you need to connect to <code>localhost:5555</code>, the port opened in the previous step to forward traffic to the EFT VM. The <a href="https://portal.azure.com/#@HMCTS.NET/asset/Microsoft_Azure_KeyVault/Secret/https://rdo-ftps-kvs.vault.azure.net/secrets/admin-username">username</a> and <a href="https://portal.azure.com/#@HMCTS.NET/asset/Microsoft_Azure_KeyVault/Secret/https://rdo-ftps-kvs.vault.azure.net/secrets/sftpadmin">password</a> can be found <a href="https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/rdo-hub-sftp-prod/providers/Microsoft.KeyVault/vaults/rdo-ftps-kvs/secrets">here</a>.</p>
<h2 id="eft-configuratiion">EFT Configuratiion</h2>
<h3 id="site-root">Site root</h3>
<p>The site root folder is the storage location where files are stored. It is currently using an <a href="https://portal.azure.com/#@HMCTS.NET/resource/subscriptions/0978315c-75fe-4ada-9d11-1eb5e0e0b214/resourceGroups/rdo-hub-sftp-prod/providers/Microsoft.Storage/storageAccounts/rdohubsftpprod/overview">Azure File Share</a> to store these files. This is configured in the EFT software.</p>

<blockquote>
<p>Changing this location on EFT will render users unable to interact with SFTP as it will remove all user and group folder permissions.</p>
</blockquote>
<p>If you do need to change the location, be aware of the previous permissions and redefine them after. This is done in VFS.</p>
<p>To change the location:
- stop the GlobalScape service on both nodes
- copy all files from the old share to the new
- point the site root directory to the new share then start the services again.</p>
<p>Make sure you have added the folder permissions back in VFS.</p>
<h3 id="vfs">VFS</h3>
<p>This is where the file structure for the users are managed. It is where access to storage where they can upload/download files is controlled. For example, SSCS users will only have access to the <code>sscs</code> directory and nothing else.</p>
<h2 id="testing">Testing</h2>
<p>You can test SFTP by logging in as one of the <code>sscs</code> service accounts for example. The keys are stored in sscs-aat/prod.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>sftp -i &lt;sscs-key&gt; sscs-&lt;env&gt;@sftp.platform.hmcts.net 
</code></pre></div><p><a href="https://linuxize.com/post/how-to-use-linux-sftp-command-to-transfer-files/">More info on <code>sftp</code> command</a></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>In the bottom left open the Windows control panel and click <code>Server Manager</code>. You can also view logs and configuration in the <code>EFT Enterprise Application</code>.</p>
<p>You can view EFT software logs such as startup by going to <code>C:\ProgramData\Globalscape\EFT Server Enterprise</code> then you can view the file <code>EFT-eft-0.log</code> for the eft-0 machine. Start by finding <code>Starting EFT</code> in the file and continue from there to look for any <code>ERROR</code> messages</p>
<p>You can also see logs on how files have been moved around and by whom by going to <code>C:\ProgramData\Globalscape\EFT Server Enterprise\Logs</code> and viewing the log files there.</p>
<h2 id="support">Support</h2>
<p>The current support contract is with a company called Pro2col Group, here are the contact details for raising a support call</p>
<p>Telephone: 0333 123 1240</p>
<p>Email: support@pro2colgroup.com</p>
