<h1 id="f5-vpn-config">F5 VPN Config</h1>
<p>This document details the steps to configure routing to make internal apps available over the vpn.</p>
<h2 id="routing">Routing</h2>

<ol>
<li>Connect to the <a href="https://portal.platform.hmcts.net">VPN</a></li>
<li><p>Login to <a href="https://vpn.platform.hmcts.net/">https://vpn.platform.hmcts.net/</a>.\
If you are accessing the F5 portal for the first time, submit a pull request to the <a href="accounts.md">user accounts</a> file in this repo and ask someone with existing access to create your account.
If you lose your login details, a person with existing access can provide you with new credentials.</p></li>
<li><p>For making the changes to the ACL: click &lsquo;Access → &#39;Access Control Lists&rsquo; → &lsquo;acl_vpn_reform&rsquo;, <a href="https://vpn.platform.hmcts.net/tmui/Control/jspmap/tmui/accessctrl/acls/properties.jsp?name=/Common/acl_vpn_reform">direct link</a></p></li>
<li><p>You will see a list of ACLs for all the entries. Open two tabs in your browser on the same page, open an existing one and then click &lsquo;Add&rsquo; for your new one. Copy the required details from the existing one to the new one.
Note: If using Firefox then the search function probably won&rsquo;t find the IP address you type in.</p></li>
<li><p>You will find 2 entries; HTTP and HTTPS. Change it to add new CIDR range, such as below:
<img src=images/properties.png  width="400"></p></li>
</ol>
<h2 id="access-policy">Access Policy</h2>

<ol>
<li><p>Navigate to Connectivity profiles to make a corresponding change to the routing.\
<a href="https://vpn.platform.hmcts.net/tmui/tmui/util/ajax/app.jsp?appId=apps.AccessPolicy.perclientpolicy">Connectivity Profiles</a></p></li>
<li><p>Add the new CIDR range under IPV4 and IPV6 . After verification, click on the <code>Apply Access policy</code> on the top left corner of the portal to propagate the routing changes.\
<a href="https://vpn.platform.hmcts.net/tmui/Control/jspmap/tmui/remconnectivity/nwaccessresources/l2_settings.jsp?name=/Common/netacl_mojvpn&amp;type=1">VPN ACL</a></p></li>
<li><p>Logout of your current F5 VPN session (<a href="https://portal.platform.hmcts.net">https://portal.platform.hmcts.net</a>) and log back in to validate if the routing table update has taken place for the new network address space as shown below:</p></li>
</ol>

<p float="left">
<img src=images/VPN_Routing_table.png  width="400" />
<img src=images/Routing_Change.png  width="400" />
</p>
<h2 id="apply-access-policy">Apply Access Policy</h2>
<p>Once you have made a change to F5, you are required to Apply Access Policy.</p>

<ol>
<li>When a change has been made, you need to Apply Access Policy before change is effective on F5. You will notice this in top left of the F5 Portal when you have made a change.</li>
</ol>
<p>Select Apply Access Policy</p>
<p><img src=images/apply_access_policy.png  width="400"></p>

<ol>
<li>Review Access profile &amp; ensure option prof_portal.platform.hmcts.net is ticked</li>
</ol>
<p>Select Apply</p>
<p><img src=images/apply_access_profile.png  width="400"></p>

<ol>
<li>Access profile policies are then shown, it should already be ticked for all.</li>
</ol>
<p>Select Apply</p>
<p><img src=images/apply_access_profile_all.png  width="400"></p>

<ol>
<li>Once successful apply, all access profiles should be green</li>
</ol>
<p><img src=images/apply_access_policy_review.png  width="400"></p>
