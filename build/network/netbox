<h1 id="using-netbox-to-get-available-address-space">Using Netbox to get available address space</h1>
<h2 id="vnet-peering-issue-due-to-address-space-clash">VNet peering issue due to address space clash</h2>
<p>This is in relation to a VNet peering issue due to address space clash and the user needed new available address space.  See ticket for more informatio:</p>
<p>https://tools.hmcts.net/jira/browse/DTSPO-9414</p>
<h3 id="check-address-space-range">Check address space range</h3>
<p>Check the existing address space in use by checking the address space within virtual network in Azure portal.  For example /28 for vh-wowza-dev (10.50.10.32/28)</p>
<h3 id="netbox-for-available-address-spaces">Netbox for available address spaces</h3>
<p>Open the following URL to access Netbox (make sure you are connected to the VPN):</p>
<p>https://netbox.platform.hmcts.net/ipam/prefixes/446/prefixes/?per_page=1000</p>
<p>Check for the addresses marked as available and not active for the required address range (i.e. /28)</p>
<h3 id="run-the-curl-commands-to-verify-the-address-space-is-not-in-use">Run the curl commands to verify the address space is not in use</h3>
<p>Note - this uses the jq command.  If you don&rsquo;t have this then run:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>brew install jq
</code></pre></div><p>Run the following command to check that the address space is not in use (using 10.50.11.16/28 as an example):</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>➜  ~ curl -X GET -k https://netbox.platform.hmcts.net:443/api/ipam/prefixes/\?within\=10.50.11.16%2F28 -H "accept: application/json" | jq .
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    52  100    52    0     0     11      0  0:00:04  0:00:04 --:--:--    12
{
  "count": 0,
  "next": null,
  "previous": null,
  "results": []
}
</code></pre></div><p>The following is an example when an address space is in use and can&rsquo;t be used:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>➜  ~ curl -X GET -k https://netbox.platform.hmcts.net:443/api/ipam/prefixes/\?within\=10.50.0.0%2F16 -H "accept: application/json" | jq .
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 13084  100 13084    0     0  16499      0 --:--:-- --:--:-- --:--:-- 16478
{
  "count": 17,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": 82,
      "url": "http://netbox.platform.hmcts.net/api/ipam/prefixes/82/",
      "display": "10.50.10.0/28",
      "family": {
        "value": 4,
        "label": "IPv4"
      },
      ........
  ]
}
</code></pre></div><p>Please also reference the following GitHub repo link for more information regarding Netbox:</p>
<p>https://github.com/hmcts/rdo-netbox/blob/master/README.md</p>
<h3 id="azure-devops-pipeline">Azure DevOps Pipeline</h3>
<p>The following Azure DevOps pipeline is run daily at 7:00 AM and can be manually run to get the latest available address spaces:</p>
<p>https://dev.azure.com/hmcts/PlatformOperations/_build?definitionId=345&amp;_a=summary</p>
